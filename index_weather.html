<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8"><link rel="icon" href="https://static.jianshukeji.com/highcharts/images/favicon.ico">
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{margin:0;apdding:0;list-style:none;}
.clear{clear:both;}
table{border-collapse:collapse;border-color:#85579e;}
body{background-image:linear-gradient(#0d0933 15%, #3c2aec 80%);font-family:"Microsoft Yahei";color:#fff;height:10.80rem;}
/*data_top*/
.data_top{position:relative;}
.data_top h1{text-align:center;font-size:0.65rem;font-weight:normal;line-height:1.35rem;}
.data_top .d_timebox{position:absolute;top:0.5rem;left:0.3rem;}
.data_top .d_timebox img{float:left;}
.data_top .d_timebox #localtime{font-size:0.16rem;line-height:0.45rem;padding:0 0.1rem;}

/*weather_content*/
.weather_content {background:rgba(0, 0, 0, 0.1);border-radius:0.03rem;margin:0.3rem;}

/*footer*/
.footer{font-size:0.14rem;color:#7c6df5;margin:0.3rem 0 0 0.28rem;}
.footer span a{color:#a295ff;}

</style>
    <script src="js/main_t.js"></script>


</head>

<body>
	<!--top start-->
	<div class="data_top">
    	<h1>重庆市江津区石蟆镇-蟆城供销社基地-天气情况</h1>
        <div class="d_timebox">
            <img src="images/clock.png" alt="time" width="45" height="45" />
            <span id="localtime">2017-06-20 10:42:31</span>
        </div>
    </div>
    <!--end top-->
    
    <!--weather_content-->
    <div class="weather_content">
        <!--a_table start-->
        <div id="container">
            <div style="margin-top: 100px; text-align: center" id="loading">
                <i class="fa fa-spinner fa-spin"></i> 从外部源加载数据
            </div>
        </div>
        <!--end a_table -->
    </div>

    <div class="footer">
        <span>直播动态  DataView 提供运营动态直播、数据综合展示、设备监控预警等多种场景模板，稍加修改就能够直接服务于您的可视化需求。<a>数据来源: 透明云农场基地大数据平台</a></span>
    </div>
    <!--end analyze_content-->

	<script src="js/jquery-1.8.3.min.js"></script>
    <script src="js/highcharts.js"></script>
    <script src="js/highcharts-3d.js"></script>
    <script src="js/exporting.js"></script>
    <script src="js/highcharts-zh_CN.js"></script>
    <script src="js/time.js"></script>
    <script src="js/adaptive-version2.js"></script>
    
    <script type="text/javascript">
        function Meteogram(xml, container) {
            // Parallel arrays for the chart data, these are populated as the XML/JSON file
            // is loaded
            this.symbols = [];
            this.symbolNames = [];
            this.precipitations = [];
            this.windDirections = [];
            this.windDirectionNames = [];
            this.windSpeeds = [];
            this.windSpeedNames = [];
            this.temperatures = [];
            this.pressures = [];
            // Initialize
            this.xml = xml;
            this.container = container;
            // Run
            this.parseYrData();
        }
        /**
         * Return weather symbol sprites as laid out at http://om.yr.no/forklaring/symbol/
         */
        Meteogram.prototype.getSymbolSprites = function (symbolSize) {
            return {
                '01d': {
                    x: 0,
                    y: 0
                },
                '01n': {
                    x: symbolSize,
                    y: 0
                },
                '16': {
                    x: 2 * symbolSize,
                    y: 0
                },
                '02d': {
                    x: 0,
                    y: symbolSize
                },
                '02n': {
                    x: symbolSize,
                    y: symbolSize
                },
                '03d': {
                    x: 0,
                    y: 2 * symbolSize
                },
                '03n': {
                    x: symbolSize,
                    y: 2 * symbolSize
                },
                '17': {
                    x: 2 * symbolSize,
                    y: 2 * symbolSize
                },
                '04': {
                    x: 0,
                    y: 3 * symbolSize
                },
                '05d': {
                    x: 0,
                    y: 4 * symbolSize
                },
                '05n': {
                    x: symbolSize,
                    y: 4 * symbolSize
                },
                '18': {
                    x: 2 * symbolSize,
                    y: 4 * symbolSize
                },
                '06d': {
                    x: 0,
                    y: 5 * symbolSize
                },
                '06n': {
                    x: symbolSize,
                    y: 5 * symbolSize
                },
                '07d': {
                    x: 0,
                    y: 6 * symbolSize
                },
                '07n': {
                    x: symbolSize,
                    y: 6 * symbolSize
                },
                '08d': {
                    x: 0,
                    y: 7 * symbolSize
                },
                '08n': {
                    x: symbolSize,
                    y: 7 * symbolSize
                },
                '19': {
                    x: 2 * symbolSize,
                    y: 7 * symbolSize
                },
                '09': {
                    x: 0,
                    y: 8 * symbolSize
                },
                '10': {
                    x: 0,
                    y: 9 * symbolSize
                },
                '11': {
                    x: 0,
                    y: 10 * symbolSize
                },
                '12': {
                    x: 0,
                    y: 11 * symbolSize
                },
                '13': {
                    x: 0,
                    y: 12 * symbolSize
                },
                '14': {
                    x: 0,
                    y: 13 * symbolSize
                },
                '15': {
                    x: 0,
                    y: 14 * symbolSize
                },
                '20d': {
                    x: 0,
                    y: 15 * symbolSize
                },
                '20n': {
                    x: symbolSize,
                    y: 15 * symbolSize
                },
                '20m': {
                    x: 2 * symbolSize,
                    y: 15 * symbolSize
                },
                '21d': {
                    x: 0,
                    y: 16 * symbolSize
                },
                '21n': {
                    x: symbolSize,
                    y: 16 * symbolSize
                },
                '21m': {
                    x: 2 * symbolSize,
                    y: 16 * symbolSize
                },
                '22': {
                    x: 0,
                    y: 17 * symbolSize
                },
                '23': {
                    x: 0,
                    y: 18 * symbolSize
                }
            };
        };
        /**
         * Function to smooth the temperature line. The original data provides only whole degrees,
         * which makes the line graph look jagged. So we apply a running mean on it, but preserve
         * the unaltered value in the tooltip.
         */
        Meteogram.prototype.smoothLine = function (data) {
            var i = data.length,
                sum,
                value;
            while (i--) {
                data[i].value = value = data[i].y; // preserve value for tooltip
                // Set the smoothed value to the average of the closest points, but don't allow
                // it to differ more than 0.5 degrees from the given value
                sum = (data[i - 1] || data[i]).y + value + (data[i + 1] || data[i]).y;
                data[i].y = Math.max(value - 0.5, Math.min(sum / 3, value + 0.5));
            }
        };
        /**
         * Callback function that is called from Highcharts on hovering each point and returns
         * HTML for the tooltip.
         */
        Meteogram.prototype.tooltipFormatter = function (tooltip) {
            // Create the header with reference to the time interval
            var index = tooltip.points[0].point.index,
                ret = '<small>' + Highcharts.dateFormat('%A, %b %e, %H:%M', tooltip.x) + '-' +
                    Highcharts.dateFormat('%H:%M', tooltip.points[0].point.to) + '</small><br>';
            // Symbol text
            ret += '<b>' + this.symbolNames[index] + '</b>';
            ret += '<table>';
            // Add all series
            Highcharts.each(tooltip.points, function (point) {
                var series = point.series;
                ret += '<tr><td><span style="color:' + series.color + '">\u25CF</span> ' + series.name +
                    ': </td><td style="white-space:nowrap">' + Highcharts.pick(point.point.value, point.y) +
                    series.options.tooltip.valueSuffix + '</td></tr>';
            });
            // Add wind
            ret += '<tr><td style="vertical-align: top">\u25CF Wind</td><td style="white-space:nowrap">' + this.windDirectionNames[index] +
                '<br>' + this.windSpeedNames[index] + ' (' +
                Highcharts.numberFormat(this.windSpeeds[index], 1) + ' m/s)</td></tr>';
            // Close
            ret += '</table>';
            return ret;
        };
        /**
         * Draw the weather symbols on top of the temperature series. The symbols are sprites of a single
         * file, defined in the getSymbolSprites function above.
         */
        Meteogram.prototype.drawWeatherSymbols = function (chart) {
            var meteogram = this,
                symbolSprites = this.getSymbolSprites(30);
            $.each(chart.series[0].data, function (i, point) {
                var sprite,
                    group;
                if (meteogram.resolution > 36e5 || i % 2 === 0) {
                    sprite = symbolSprites[meteogram.symbols[i]];
                    if (sprite) {
                        // Create a group element that is positioned and clipped at 30 pixels width and height
                        group = chart.renderer.g()
                            .attr({
                                translateX: point.plotX + chart.plotLeft - 15,
                                translateY: point.plotY + chart.plotTop - 30,
                                zIndex: 5
                            })
                            .clip(chart.renderer.clipRect(0, 0, 30, 30))
                            .add();
                        // Position the image inside it at the sprite position
                        chart.renderer.image(
                            'https://www.highcharts.com/samples/graphics/meteogram-symbols-30px.png',
                            -sprite.x,
                            -sprite.y,
                            90,
                            570
                        )
                            .add(group);
                    }
                }
            });
        };
        /**
         * Create wind speed symbols for the Beaufort wind scale. The symbols are rotated
         * around the zero centerpoint.
         */
        Meteogram.prototype.windArrow = function (name) {
            var level,
                path;
            // The stem and the arrow head
            path = [
                'M', 0, 7, // base of arrow
                'L', -1.5, 7,
                0, 10,
                1.5, 7,
                0, 7,
                0, -10 // top
            ];
            level = $.inArray(name, ['平静', '微风', '清风', '和风', '四级风',
                '清劲风', '大风', '强风', '狂风', '裂风', '暴风',
                '大风暴', '飓风']);
            if (level === 0) {
                path = [];
            }
            if (level === 2) {
                path.push('M', 0, -8, 'L', 4, -8); // short line
            } else if (level >= 3) {
                path.push(0, -10, 7, -10); // long line
            }
            if (level === 4) {
                path.push('M', 0, -7, 'L', 4, -7);
            } else if (level >= 5) {
                path.push('M', 0, -7, 'L', 7, -7);
            }
            if (level === 5) {
                path.push('M', 0, -4, 'L', 4, -4);
            } else if (level >= 6) {
                path.push('M', 0, -4, 'L', 7, -4);
            }
            if (level === 7) {
                path.push('M', 0, -1, 'L', 4, -1);
            } else if (level >= 8) {
                path.push('M', 0, -1, 'L', 7, -1);
            }
            return path;
        };
        /**
         * Draw the wind arrows. Each arrow path is generated by the windArrow function above.
         */
        Meteogram.prototype.drawWindArrows = function (chart) {
            var meteogram = this;
            $.each(chart.series[0].data, function (i, point) {
                var sprite, arrow, x, y;
                if (meteogram.resolution > 36e5 || i % 2 === 0) {
                    // Draw the wind arrows
                    x = point.plotX + chart.plotLeft + 7;
                    y = 255;
                    if (meteogram.windSpeedNames[i] === 'Calm') {
                        arrow = chart.renderer.circle(x, y, 10).attr({
                            fill: 'none'
                        });
                    } else {
                        arrow = chart.renderer.path(
                            meteogram.windArrow(meteogram.windSpeedNames[i])
                        ).attr({
                            rotation: parseInt(meteogram.windDirections[i], 10),
                            translateX: x, // rotation center
                            translateY: y // rotation center
                        });
                    }
                    arrow.attr({
                        stroke: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black',
                        'stroke-width': 1.5,
                        zIndex: 5
                    })
                        .add();
                }
            });
        };
        /**
         * Draw blocks around wind arrows, below the plot area
         */
        Meteogram.prototype.drawBlocksForWindArrows = function (chart) {
            var xAxis = chart.xAxis[0],
                x,
                pos,
                max,
                isLong,
                isLast,
                i;
            for (pos = xAxis.min, max = xAxis.max, i = 0; pos <= max + 36e5; pos += 36e5, i += 1) {
                // Get the X position
                isLast = pos === max + 36e5;
                x = Math.round(xAxis.toPixels(pos)) + (isLast ? 0.5 : -0.5);
                // Draw the vertical dividers and ticks
                if (this.resolution > 36e5) {
                    isLong = pos % this.resolution === 0;
                } else {
                    isLong = i % 2 === 0;
                }
                chart.renderer.path(['M', x, chart.plotTop + chart.plotHeight + (isLong ? 0 : 28),
                    'L', x, chart.plotTop + chart.plotHeight + 32, 'Z'])
                    .attr({
                        'stroke': chart.options.chart.plotBorderColor,
                        'stroke-width': 1
                    })
                    .add();
            }
        };
        /**
         * Get the title based on the XML data
         */
        Meteogram.prototype.getTitle = function () {
            return 'Meteogram for ' + this.xml.location.name + ', ' + this.xml.location.country;
        };
        /**
         * Build and return the Highcharts options structure
         */
        Meteogram.prototype.getChartOptions = function () {
            var meteogram = this;
            return {
                chart: {
                    renderTo: this.container,
                    marginBottom: 70,
                    marginRight: 40,
                    marginTop: 50,
                    plotBorderWidth: 1,
                    height:800,
                    backgroundColor:'rgba(5, 14, 29, 0)'//去背景
                },
                title: {
                    text:null,
                    align: 'left'
                },
                credits: {
                    text: '根据<a href="https://yr.no">yr.no</a>预测',
                    href: this.xml.credit.link['@attributes'].url,
                    position: {
                        x: -40
                    }
                },
                credits:{
                    enabled:false
                },//去掉右下角版权
                exporting: {
                    enabled:false
                },//去掉右上角选项
                tooltip: {
                    shared: true,
                    useHTML: true,
                    formatter: function () {
                        return meteogram.tooltipFormatter(this);
                    }
                },
                xAxis: [{ // Bottom X axis
                    type: 'datetime',
                    tickInterval: 2 * 36e5, // two hours
                    minorTickInterval: 36e5, // one hour
                    tickLength: 0,
                    gridLineWidth: 1,
                    gridLineColor: (Highcharts.theme && Highcharts.theme.background2) || '#F0F0F0',
                    startOnTick: false,
                    endOnTick: false,
                    minPadding: 0,
                    maxPadding: 0,
                    offset: 30,
                    showLastLabel: true,
                    labels: {
                        style:{
                            color:'#a9a9a9'
                        },
                        format: '{value:%H}'
                    }
                }, { // Top X axis
                    linkedTo: 0,
                    type: 'datetime',
                    tickInterval: 24 * 3600 * 1000,
                    labels: {
                        format: '{value:<span style="font-size: 12px; font-weight: bold">%a</span> %b %e}',
                        align: 'left',
                        x: 3,
                        y: -5
                    },
                    opposite: true,
                    tickLength: 20,
                    gridLineWidth: 1
                }],
                yAxis: [{ // temperature axis
                    title: {
                        text: null
                    },
                    labels: {
                        format: '{value}°',
                        style: {
                            color:'#a9a9a9',
                            fontSize: '10px'
                        },
                        x: -3
                    },
                    plotLines: [{ // zero plane
                        value: 0,
                        color: '#BBBBBB',
                        width: 1,
                        zIndex: 2
                    }],
                    // Custom positioner to provide even temperature ticks from top down
                    tickPositioner: function () {
                        var max = Math.ceil(this.max) + 1,
                            pos = max - 12, // start
                            ret;
                        if (pos < this.min) {
                            ret = [];
                            while (pos <= max) {
                                ret.push(pos += 1);
                            }
                        } // else return undefined and go auto
                        return ret;
                    },
                    maxPadding: 0.3,
                    tickInterval: 1,
                    gridLineColor: (Highcharts.theme && Highcharts.theme.background2) || '#F0F0F0'
                }, { // precipitation axis
                    title: {
                        text: null
                    },
                    labels: {
                        enabled: false
                    },
                    gridLineWidth: 0,
                    tickLength: 0
                }, { // Air pressure
                    allowDecimals: false,
                    title: { // Title on top of axis
                        text: 'hPa',
                        offset: 0,
                        align: 'high',
                        rotation: 0,
                        style: {
                            fontSize: '10px',
                            color: Highcharts.getOptions().colors[2]
                        },
                        textAlign: 'left',
                        x: 3
                    },
                    labels: {
                        style: {
                            fontSize: '8px',
                            color: Highcharts.getOptions().colors[2]
                        },
                        y: 2,
                        x: 3
                    },
                    gridLineWidth: 0,
                    opposite: true,
                    showLastLabel: false
                }],
                legend: {
                    enabled: false
                },
                plotOptions: {
                    line: {
                        dataLabels: {
                            enabled: true,
                            color: '#fff',//坐标上的文字颜色
                            connectorColor: '#fff'//坐标上的文字颜色
                        },
                    },
                    eries: {
                        pointPlacement: 'between'
                    }
                },
                series: [{
                    name: '温度',
                    data: this.temperatures,
                    type: 'spline',
                    marker: {
                        enabled: false,
                        states: {
                            hover: {
                                enabled: true
                            }
                        }
                    },
                    tooltip: {
                        valueSuffix: '°C'
                    },
                    zIndex: 1,
                    color: '#FF3333',
                    negativeColor: '#48AFE8'
                }, {
                    name: '降水',
                    data: this.precipitations,
                    type: 'column',
                    color: '#68CFE8',
                    yAxis: 1,
                    groupPadding: 0,
                    pointPadding: 0,
                    borderWidth: 0,
                    shadow: false,
                    dataLabels: {
                        enabled: true,
                        formatter: function () {
                            if (this.y > 0) {
                                return this.y;
                            }
                        },
                        style: {
                            fontSize: '8px'
                        }
                    },
                    tooltip: {
                        valueSuffix: 'mm'
                    }
                }, {
                    name: '气压',
                    color: Highcharts.getOptions().colors[2],
                    data: this.pressures,
                    marker: {
                        enabled: false
                    },
                    shadow: false,
                    tooltip: {
                        valueSuffix: ' hPa'
                    },
                    dashStyle: 'shortdot',
                    yAxis: 2
                }]
            }
        };
        /**
         * Post-process the chart from the callback function, the second argument to Highcharts.Chart.
         */
        Meteogram.prototype.onChartLoad = function (chart) {
            this.drawWeatherSymbols(chart);
            this.drawWindArrows(chart);
            this.drawBlocksForWindArrows(chart);
        };
        /**
         * Create the chart. This function is called async when the data file is loaded and parsed.
         */
        Meteogram.prototype.createChart = function () {
            var meteogram = this;
            this.chart = new Highcharts.Chart(this.getChartOptions(), function (chart) {
                meteogram.onChartLoad(chart);
            });
        };
        /**
         * Handle the data. This part of the code is not Highcharts specific, but deals with yr.no's
         * specific data format
         */
        Meteogram.prototype.parseYrData = function () {
            var meteogram = this,
                xml = this.xml,
                pointStart;
            if (!xml || !xml.forecast) {
                $('#loading').html('<i class="fa fa-frown-o"></i> 加载数据失败，请稍后再试');
                return;
            }
            // The returned xml variable is a JavaScript representation of the provided XML,
            // generated on the server by running PHP simple_load_xml and converting it to
            // JavaScript by json_encode.
            $.each(xml.forecast.tabular.time, function (i, time) {
                // Get the times - only Safari can't parse ISO8601 so we need to do some replacements
                var from = time['@attributes'].from + ' UTC',
                    to = time['@attributes'].to + ' UTC';
                from = from.replace(/-/g, '/').replace('T', ' ');
                from = Date.parse(from);
                to = to.replace(/-/g, '/').replace('T', ' ');
                to = Date.parse(to);
                if (to > pointStart + 4 * 24 * 36e5) {
                    return;
                }
                // If it is more than an hour between points, show all symbols
                if (i === 0) {
                    meteogram.resolution = to - from;
                }
                // Populate the parallel arrays
                meteogram.symbols.push(time.symbol['@attributes']['var'].match(/[0-9]{2}[dnm]?/)[0]);
                meteogram.symbolNames.push(time.symbol['@attributes'].name);
                meteogram.temperatures.push({
                    x: from,
                    y: parseInt(time.temperature['@attributes'].value),
                    // custom options used in the tooltip formatter
                    to: to,
                    index: i
                });
                meteogram.precipitations.push({
                    x: from,
                    y: parseFloat(time.precipitation['@attributes'].value)
                });
                meteogram.windDirections.push(parseFloat(time.windDirection['@attributes'].deg));
                meteogram.windDirectionNames.push(time.windDirection['@attributes'].name);
                meteogram.windSpeeds.push(parseFloat(time.windSpeed['@attributes'].mps));
                meteogram.windSpeedNames.push(time.windSpeed['@attributes'].name);
                meteogram.pressures.push({
                    x: from,
                    y: parseFloat(time.pressure['@attributes'].value)
                });
                if (i == 0) {
                    pointStart = (from + to) / 2;
                }
            });
            // Smooth the line
            this.smoothLine(this.temperatures);
            // Create the chart when the data is loaded
            this.createChart();
        };
        // End of the Meteogram protype
        $(function () { // On DOM ready...
            // Set the hash to the yr.no URL we want to parse
            if (!location.hash) {
                var place = 'United_Kingdom/England/London';
                //place = 'France/Rhône-Alpes/Val_d\'Isère~2971074';
                //place = 'Norway/Sogn_og_Fjordane/Vik/Målset';
                //place = 'United_States/California/San_Francisco';
                //place = 'United_States/Minnesota/Minneapolis';
                location.hash = 'http://www.yr.no/place/' + place + '/forecast_hour_by_hour.xml';
            }
            // Then get the XML file through Highcharts' jsonp provider, see
            // https://github.com/highslide-software/highcharts.com/blob/master/samples/data/jsonp.php
            // for source code.
            $.getJSON(
                'https://www.highcharts.com/samples/data/jsonp.php?url=' + location.hash.substr(1) + '&callback=?',
                function (xml) {
                    var meteogram = new Meteogram(xml, 'container');
                }
            );
        });

    </script>

</body>

</html>

​
